"use strict";var yt=Object.create;var X=Object.defineProperty;var St=Object.getOwnPropertyDescriptor;var Et=Object.getOwnPropertyNames;var It=Object.getPrototypeOf,Ct=Object.prototype.hasOwnProperty;var Rt=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Tt=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Et(e))!Ct.call(t,n)&&n!==r&&X(t,n,{get:()=>e[n],enumerable:!(i=St(e,n))||i.enumerable});return t};var P=(t,e,r)=>(r=t!=null?yt(It(t)):{},Tt(e||!t||!t.__esModule?X(r,"default",{value:t,enumerable:!0}):r,t));var pt=Rt((er,D)=>{"use strict";var Jt=Object.prototype.hasOwnProperty,f="~";function I(){}Object.create&&(I.prototype=Object.create(null),new I().__proto__||(f=!1));function Wt(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function ft(t,e,r,i,n){if(typeof r!="function")throw new TypeError("The listener must be a function");var o=new Wt(r,i||t,n),c=f?f+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],o]:t._events[c].push(o):(t._events[c]=o,t._eventsCount++),t}function N(t,e){--t._eventsCount===0?t._events=new I:delete t._events[e]}function h(){this._events=new I,this._eventsCount=0}h.prototype.eventNames=function(){var e=[],r,i;if(this._eventsCount===0)return e;for(i in r=this._events)Jt.call(r,i)&&e.push(f?i.slice(1):i);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(r)):e};h.prototype.listeners=function(e){var r=f?f+e:e,i=this._events[r];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,o=i.length,c=new Array(o);n<o;n++)c[n]=i[n].fn;return c};h.prototype.listenerCount=function(e){var r=f?f+e:e,i=this._events[r];return i?i.fn?1:i.length:0};h.prototype.emit=function(e,r,i,n,o,c){var a=f?f+e:e;if(!this._events[a])return!1;var s=this._events[a],u=arguments.length,l,_;if(s.fn){switch(s.once&&this.removeListener(e,s.fn,void 0,!0),u){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,r),!0;case 3:return s.fn.call(s.context,r,i),!0;case 4:return s.fn.call(s.context,r,i,n),!0;case 5:return s.fn.call(s.context,r,i,n,o),!0;case 6:return s.fn.call(s.context,r,i,n,o,c),!0}for(_=1,l=new Array(u-1);_<u;_++)l[_-1]=arguments[_];s.fn.apply(s.context,l)}else{var p=s.length,d;for(_=0;_<p;_++)switch(s[_].once&&this.removeListener(e,s[_].fn,void 0,!0),u){case 1:s[_].fn.call(s[_].context);break;case 2:s[_].fn.call(s[_].context,r);break;case 3:s[_].fn.call(s[_].context,r,i);break;case 4:s[_].fn.call(s[_].context,r,i,n);break;default:if(!l)for(d=1,l=new Array(u-1);d<u;d++)l[d-1]=arguments[d];s[_].fn.apply(s[_].context,l)}}return!0};h.prototype.on=function(e,r,i){return ft(this,e,r,i,!1)};h.prototype.once=function(e,r,i){return ft(this,e,r,i,!0)};h.prototype.removeListener=function(e,r,i,n){var o=f?f+e:e;if(!this._events[o])return this;if(!r)return N(this,o),this;var c=this._events[o];if(c.fn)c.fn===r&&(!n||c.once)&&(!i||c.context===i)&&N(this,o);else{for(var a=0,s=[],u=c.length;a<u;a++)(c[a].fn!==r||n&&!c[a].once||i&&c[a].context!==i)&&s.push(c[a]);s.length?this._events[o]=s.length===1?s[0]:s:N(this,o)}return this};h.prototype.removeAllListeners=function(e){var r;return e?(r=f?f+e:e,this._events[r]&&N(this,r)):(this._events=new I,this._eventsCount=0),this};h.prototype.off=h.prototype.removeListener;h.prototype.addListener=h.prototype.on;h.prefixed=f;h.EventEmitter=h;typeof D<"u"&&(D.exports=h)});var gt=require("@polkadot/api"),K=P(require("@substrate/connect"));function Ht(t){return t("return this")}var m=typeof globalThis<"u"?globalThis:typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:Ht(Function);function V(t,e){return typeof m[t]>"u"?e:m[t]}function b(t){return typeof t=="function"}function kt(){return Number.NaN}var q=V("BigInt",kt);var v="0123456789abcdef",R=new Uint8Array(256),z=new Uint8Array(256*256);for(let t=0,e=v.length;t<e;t++)R[v[t].charCodeAt(0)|0]=t|0,t>9&&(R[v[t].toUpperCase().charCodeAt(0)|0]=t|0);for(let t=0;t<256;t++){let e=t<<8;for(let r=0;r<256;r++)z[e|r]=R[t]<<4|R[r]}function Y(t,e=-1){if(!t)return new Uint8Array;let r=t.startsWith("0x")?2:0,i=Math.ceil((t.length-r)/2),n=Math.ceil(e===-1?i:e/8),o=new Uint8Array(n),c=n>i?n-i:0;for(let a=c;a<n;a++,r+=2)o[a]=z[t.charCodeAt(r)<<8|t.charCodeAt(r+1)];return o}var B=P(require("bn.js"),1);function Q(t){return B.default.isBN(t)}var Ot=/^0x[\da-fA-F]+$/;function Z(t,e=-1,r){return typeof t=="string"&&(t==="0x"||Ot.test(t))&&(e===-1?r||t.length%2===0:t.length===2+Math.ceil(e/4))}function g(t){return!!t&&typeof t=="object"}var ie=typeof q=="function"&&typeof q.asIntN=="function";var tt=typeof m.Buffer=="function"&&typeof m.Buffer.isBuffer=="function",et=typeof m.process=="object";function T(t){return tt&&!!t&&b(t.readDoubleLE)&&m.Buffer.isBuffer(t)}function H(t){return(t&&t.constructor)===Uint8Array||t instanceof Uint8Array}var rt=require("@polkadot/x-textencoder"),jt=new rt.TextEncoder;function nt(t){return t?jt.encode(t.toString()):new Uint8Array}function it(t){return H(t)?T(t)?new Uint8Array(t):t:Z(t)?Y(t):Array.isArray(t)?new Uint8Array(t):nt(t)}var k=new Array(256),st=new Array(256*256);for(let t=0;t<256;t++)k[t]=t.toString(16).padStart(2,"0");for(let t=0;t<256;t++){let e=t<<8;for(let r=0;r<256;r++)st[e|r]=k[t]+k[r]}function $(t,e){let r=t.length%2|0,i=t.length-r|0;for(let n=0;n<i;n+=2)e+=st[t[n]<<8|t[n+1]];return r&&(e+=k[t[i]|0]),e}function ot(t,e=-1,r=!0){let i=r?"0x":"";if(t?.length){if(e>0){let n=Math.ceil(e/8);if(t.length>n)return`${$(t.subarray(0,n/2),i)}\u2026${$(t.subarray(t.length-n/2),"")}`}}else return i;return $(t,i)}function ct(t){return typeof t=="bigint"}function w(t){return t.toString().padStart(2,"0")}function at(t){let e=t.getFullYear().toString(),r=w(t.getMonth()+1),i=w(t.getDate()),n=w(t.getHours()),o=w(t.getMinutes()),c=w(t.getSeconds());return`${e}-${r}-${i} ${n}:${o}:${c}`}function O(t){return typeof t=="string"||t instanceof String}function M(t){return(t&&t.constructor)===Error||t instanceof Error}function At(t,e){return ct(e)?e.toString():e}function x(t,e){return JSON.stringify(t,At,e)}function j(t){return typeof t=="number"}function y(t){return t===void 0}function J(){}var Ut={debug:"log",error:"error",log:"log",warn:"warn"};function Nt(t){if(t&&g(t)&&t.constructor===Object){let e={};for(let[r,i]of Object.entries(t))e[r]=W(i);return e}return t}function W(t){return Array.isArray(t)?t.map(W):Q(t)?t.toString():H(t)||T(t)?ot(it(t)):Nt(t)}function Pt(t){return e=>{if(t<=0)return e;let r=`${e}`;return r.length<t?e:`${r.substring(0,t)} ...`}}function S(t,e,r,i=-1){if(r.length===1&&b(r[0])){let n=r[0]();return S(t,e,Array.isArray(n)?n:[n],i)}console[Ut[t]](at(new Date),e,...r.map(W).map(Pt(i)))}function qt(t,e){return!!t&&(t==="*"||e===t||t.endsWith("*")&&e.startsWith(t.slice(0,-1)))}function vt(t,e){return!!t&&t.startsWith("-")&&(e===t.slice(1)||t.endsWith("*")&&e.startsWith(t.slice(1,-1)))}function Bt(t,e){let r=!1;for(let i of t)qt(i,e)?r=!0:vt(i,e)&&(r=!1);return r}function $t(t){let e=(et?m.process:{}).env||{},r=parseInt(e.DEBUG_MAX||"-1",10);return[Bt((e.DEBUG||"").toLowerCase().split(","),t),isNaN(r)?-1:r]}function _t(t){let e=`${t.toUpperCase()}:`.padStart(16),[r,i]=$t(t.toLowerCase());return{debug:r?(...n)=>S("debug",e,n,i):J,error:(...n)=>S("error",e,n),log:(...n)=>S("log",e,n),noop:J,warn:(...n)=>S("warn",e,n)}}function F(t,...e){for(let r=0,i=e.length;r<i;r++){let n=e[r];if(n)if(typeof n.entries=="function")for(let[o,c]of n.entries())t[o]=c;else Object.assign(t,n)}return t}var ut=-99999;function E(t,e,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:r})}var A=class extends Error{constructor(e="",r=ut,i){if(super(),E(this,"message",String(e)),E(this,"name",this.constructor.name),E(this,"data",i),E(this,"code",r),b(Error.captureStackTrace))Error.captureStackTrace(this,this.constructor);else{let{stack:n}=new Error(e);n&&E(this,"stack",n)}}};A.CODES={ASSERT:-90009,INVALID_JSONRPC:-99998,METHOD_NOT_FOUND:-32601,UNKNOWN:ut};var lt=A;function Mt(t){if(y(t))return"";let e=`: ${O(t)?t.replace(/Error\("/g,"").replace(/\("/g,"(").replace(/"\)/g,")").replace(/\(/g,", ").replace(/\)/g,""):x(t)}`;return e.length<=256?e:`${e.substring(0,255)}\u2026`}function ht(t){if(t){let{code:e,data:r,message:i}=t;throw new lt(`${e}: ${i}${Mt(r)}`,e,r)}}var U=class{constructor(){this.__internal__id=0}decodeResponse(e){if(!e||e.jsonrpc!=="2.0")throw new Error("Invalid jsonrpc field in decoded object");let r=!y(e.params)&&!y(e.method);if(!j(e.id)&&(!r||!j(e.params.subscription)&&!O(e.params.subscription)))throw new Error("Invalid id field in decoded object");if(ht(e.error),e.result===void 0&&!r)throw new Error("No result found in jsonrpc response");return r?(ht(e.params.error),e.params.result):e.result}encodeJson(e,r){let[i,n]=this.encodeObject(e,r);return[i,x(n)]}encodeObject(e,r){let i=++this.__internal__id;return[i,{id:i,jsonrpc:"2.0",method:e,params:r}]}};var L=P(pt(),1);function dt(){let t=null,e=null;return{responsePassThrough:r=>t===null?r:t.responsePassThrough(r),sendJsonRpc:r=>{if(!e)throw new Error("setSendJsonRpc must be called before sending requests");t===null?e(r):t.sendJsonRpc(r)},setSendJsonRpc:r=>{e=r},start:r=>{if(t!==null)throw new Error("Can't start the health checker multiple times in parallel");if(!e)throw new Error("setSendJsonRpc must be called before starting the health checks");t=new G(r,e),t.update(!0)},stop:()=>{t!==null&&(t.destroy(),t=null)}}}var G=class{constructor(e,r){this.__internal__currentHealthCheckId=null,this.__internal__currentHealthTimeout=null,this.__internal__currentSubunsubRequestId=null,this.__internal__currentSubscriptionId=null,this.__internal__isSyncing=!1,this.__internal__nextRequestId=0,this.sendJsonRpc=i=>{let n;try{n=JSON.parse(i)}catch{return}if(n.id){let o="extern:"+x(n.id);n.id=o}this.__internal__requestToSmoldot(n)},this.responsePassThrough=i=>{let n;try{n=JSON.parse(i)}catch{return i}if(n.id&&this.__internal__currentHealthCheckId===n.id)return this.__internal__currentHealthCheckId=null,n.result?(this.__internal__healthCallback(n.result),this.__internal__isSyncing=n.result.isSyncing,this.update(!1),null):(this.update(!1),null);if(n.id&&this.__internal__currentSubunsubRequestId===n.id)return this.__internal__currentSubunsubRequestId=null,n.result?(this.__internal__currentSubscriptionId?this.__internal__currentSubscriptionId=null:this.__internal__currentSubscriptionId=n.result,this.update(!1),null):(this.update(!1),null);if(n.params&&this.__internal__currentSubscriptionId&&n.params.subscription===this.__internal__currentSubscriptionId)return this.update(!0),null;if(n.id){let o=n.id;if(!o.startsWith("extern:"))throw new Error("State inconsistency in health checker");let c=JSON.parse(o.slice(7));n.id=c}return x(n)},this.update=i=>{if(i&&this.__internal__currentHealthTimeout&&(clearTimeout(this.__internal__currentHealthTimeout),this.__internal__currentHealthTimeout=null),!this.__internal__currentHealthTimeout){let n=()=>{this.__internal__currentHealthTimeout=null,!this.__internal__currentHealthCheckId&&(this.__internal__currentHealthCheckId=`health-checker:${this.__internal__nextRequestId}`,this.__internal__nextRequestId+=1,this.__internal__requestToSmoldot({id:this.__internal__currentHealthCheckId,jsonrpc:"2.0",method:"system_health",params:[]}))};i?n():this.__internal__currentHealthTimeout=setTimeout(n,1e3)}this.__internal__isSyncing&&!this.__internal__currentSubscriptionId&&!this.__internal__currentSubunsubRequestId&&this.startSubscription(),!this.__internal__isSyncing&&this.__internal__currentSubscriptionId&&!this.__internal__currentSubunsubRequestId&&this.endSubscription()},this.startSubscription=()=>{if(this.__internal__currentSubunsubRequestId||this.__internal__currentSubscriptionId)throw new Error("Internal error in health checker");this.__internal__currentSubunsubRequestId=`health-checker:${this.__internal__nextRequestId}`,this.__internal__nextRequestId+=1,this.__internal__requestToSmoldot({id:this.__internal__currentSubunsubRequestId,jsonrpc:"2.0",method:"chain_subscribeNewHeads",params:[]})},this.endSubscription=()=>{if(this.__internal__currentSubunsubRequestId||!this.__internal__currentSubscriptionId)throw new Error("Internal error in health checker");this.__internal__currentSubunsubRequestId=`health-checker:${this.__internal__nextRequestId}`,this.__internal__nextRequestId+=1,this.__internal__requestToSmoldot({id:this.__internal__currentSubunsubRequestId,jsonrpc:"2.0",method:"chain_unsubscribeNewHeads",params:[this.__internal__currentSubscriptionId]})},this.destroy=()=>{this.__internal__currentHealthTimeout&&(clearTimeout(this.__internal__currentHealthTimeout),this.__internal__currentHealthTimeout=null)},this.__internal__healthCallback=e,this.__internal__requestToSmoldot=i=>r(x(i))}};var mt=_t("api-substrate-connect"),bt=new Map([["author_submitAndWatchExtrinsic","author_unwatchExtrinsic"],["chain_subscribeAllHeads","chain_unsubscribeAllHeads"],["chain_subscribeFinalizedHeads","chain_unsubscribeFinalizedHeads"],["chain_subscribeFinalisedHeads","chain_subscribeFinalisedHeads"],["chain_subscribeNewHeads","chain_unsubscribeNewHeads"],["chain_subscribeNewHead","chain_unsubscribeNewHead"],["chain_subscribeRuntimeVersion","chain_unsubscribeRuntimeVersion"],["subscribe_newHead","unsubscribe_newHead"],["state_subscribeRuntimeVersion","state_unsubscribeRuntimeVersion"],["state_subscribeStorage","state_unsubscribeStorage"]]),xt=new WeakMap,C=class{constructor(e,r,i){if(this.__internal__coder=new U,this.__internal__subscriptions=new Map,this.__internal__resubscribeMethods=new Map,this.__internal__requests=new Map,this.__internal__eventemitter=new L.default,this.__internal__chain=null,this.__internal__isChainReady=!1,this.__internal__resubscribe=()=>{let n=[];this.__internal__resubscribeMethods.forEach(o=>{if(!o.type.startsWith("author_"))try{let c=new Promise(a=>{this.subscribe(o.type,o.method,o.params,o.callback).catch(s=>console.log(s)),a()});n.push(c)}catch(c){mt.error(c)}}),Promise.all(n).catch(o=>mt.log(o))},!g(e)||!g(e.WellKnownChain)||!b(e.createScClient))throw new Error("Expected an @substrate/connect interface as first parameter to ScProvider");this.__internal__Sc=e,this.__internal__spec=r,this.__internal__sharedSandbox=i,this.__internal__wellKnownChains=new Set(Object.values(e.WellKnownChain))}get hasSubscriptions(){return!0}get isClonable(){return!1}get isConnected(){return!!this.__internal__chain&&this.__internal__isChainReady}clone(){throw new Error("clone() is not supported.")}async connect(e,r=dt){if(this.isConnected)throw new Error("Already connected!");if(this.__internal__chain){await this.__internal__chain;return}this.__internal__sharedSandbox&&!this.__internal__sharedSandbox.isConnected&&await this.__internal__sharedSandbox.connect();let i=this.__internal__sharedSandbox?xt.get(this.__internal__sharedSandbox):this.__internal__Sc.createScClient(e);if(!i)throw new Error("Unkown ScProvider!");xt.set(this,i);let n=r(),o=a=>{let s=n.responsePassThrough(a);if(!s)return;let u=JSON.parse(s),l;try{l=this.__internal__coder.decodeResponse(u)}catch(d){l=d}if(u.params?.subscription===void 0||!u.method)return this.__internal__requests.get(u.id)?.(l);let _=`${u.method}::${u.params.subscription}`,p=this.__internal__subscriptions.get(_)?.[0];p?.(l)},c=this.__internal__wellKnownChains.has(this.__internal__spec)?i.addWellKnownChain:i.addChain;this.__internal__chain=c(this.__internal__spec,o).then(a=>{n.setSendJsonRpc(a.sendJsonRpc),this.__internal__isChainReady=!1;let s=()=>{let _=new Error("Disconnected");this.__internal__requests.forEach(p=>p(_)),this.__internal__subscriptions.forEach(([p])=>p(_)),this.__internal__subscriptions.clear()},u=[],l=()=>{if(u.length===0)return;let _=u.pop();if(!_)throw new Error("Unable to get stale subscription");let{id:p,unsubscribeMethod:d}=_;Promise.race([this.send(d,[p]).catch(()=>{}),new Promise(wt=>setTimeout(wt,500))]).then(l).catch(()=>{})};return n.start(_=>{let p=!_.isSyncing&&(_.peers>0||!_.shouldHavePeers);this.__internal__isChainReady!==p&&(this.__internal__isChainReady=p,p?(l(),this.__internal__eventemitter.emit("connected"),this.__internal__resubscribeMethods.size&&this.__internal__resubscribe()):([...this.__internal__subscriptions.values()].forEach(d=>{u.push(d[1])}),s(),this.__internal__eventemitter.emit("disconnected")))}),F({},a,{remove:()=>{n.stop(),a.remove(),s()},sendJsonRpc:n.sendJsonRpc.bind(n)})});try{await this.__internal__chain}catch(a){throw this.__internal__chain=null,this.__internal__eventemitter.emit("error",a),a}}async disconnect(){if(!this.__internal__chain)return;let e=await this.__internal__chain;this.__internal__chain=null,this.__internal__isChainReady=!1;try{e.remove()}catch{}this.__internal__eventemitter.emit("disconnected")}on(e,r){return e==="connected"&&this.isConnected&&r(),this.__internal__eventemitter.on(e,r),()=>{this.__internal__eventemitter.removeListener(e,r)}}async send(e,r){if(!this.isConnected||!this.__internal__chain)throw new Error("Provider is not connected");let i=await this.__internal__chain,[n,o]=this.__internal__coder.encodeJson(e,r),c=new Promise((a,s)=>{this.__internal__requests.set(n,u=>{(M(u)?s:a)(u)});try{i.sendJsonRpc(o)}catch(u){this.__internal__chain=null;try{i.remove()}catch{}this.__internal__eventemitter.emit("error",u)}});try{return await c}finally{this.__internal__requests.delete(n)}}async subscribe(e,r,i,n){if(!bt.has(r))throw new Error(`Unsupported subscribe method: ${r}`);let o=await this.send(r,i),c=`${e}::${o}`,a=u=>{u instanceof Error?n(u,void 0):n(null,u)},s=bt.get(r);if(!s)throw new Error("Invalid unsubscribe method found");return this.__internal__resubscribeMethods.set(c,{callback:n,method:r,params:i,type:e}),this.__internal__subscriptions.set(c,[a,{id:o,unsubscribeMethod:s}]),o}unsubscribe(e,r,i){if(!this.isConnected)throw new Error("Provider is not connected");let n=`${e}::${i}`;return this.__internal__subscriptions.has(n)?(this.__internal__resubscribeMethods.delete(n),this.__internal__subscriptions.delete(n),this.send(r,[i])):Promise.reject(new Error(`Unable to find active subscription=${n}`))}};var Ft=t=>{if(!t)return;let e=Object.fromEntries(Object.entries(t.info).map(([r,i])=>[r,i]).filter(([,r])=>r&&!Object.keys(r).includes("None")&&r!=="None"));return delete e.additional,e},Dt=async()=>{let t=new C(K,K.WellKnownChain.ksmcc3);await t.connect();let e=new gt.ApiPromise({provider:t});await e.isReady;try{let n=(await(await e.query.fellowshipCollective.members).keys()).map(({args:[a]})=>a),o=[];console.log("fellowMembersRankId",n.length),n.forEach(a=>{o.push(e.query.identity.identityOf(a))}),(await Promise.all(o)).forEach(a=>{let s=Ft(a.toHuman());s&&console.log(s)})}catch(r){console.log("error: ",r)}};Dt();
